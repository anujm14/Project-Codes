---
title: "Instacart Exploratory Analysis"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


Exploratory Analysis Instacart Market Basket to predict product reorder

```{r}
library(data.table)

aisles <- fread('D:/instacart_2017_05_01/aisles.csv')
departments <- fread('D:/instacart_2017_05_01/departments.csv')
orders <- fread('D:/instacart_2017_05_01/orders.csv')
products <- fread('D:/instacart_2017_05_01/products.csv')
order_products <- fread('D:/instacart_2017_05_01/order_products__train.csv')
order_products_prior <- fread('D:/instacart_2017_05_01/order_products__prior.csv')

```

Quick glance at dataset

```{r}
#Order
head(orders,10)
str(orders)
summary(orders)

```

Let's find out when people do grocery shopping
```{r}
library(ggplot2)
ggplot(aes(x=orders$order_hour_of_day))+ geom_histogram(stat = "count", fill="blue")

```

Convert character variables to factors
```{r}
library(dplyr)
#Recoing variables
orders <- orders %>% mutate(order_hour_of_day = as.numeric(order_hour_of_day), eval_set = as.factor(eval_set))
products <- products %>% mutate(product_name = as.factor(product_name))
aisles <- aisles %>% mutate(aisle = as.factor(aisle))
departments <- departments %>% mutate(department = as.factor(department))
```

when people do grocery shopping
```{r}
orders %>% 
  ggplot(aes(x=order_hour_of_day)) + 
  geom_histogram(stat="count",fill="blue")

```

Which day of week, people are ordering more
```{r}
orders %>% 
  ggplot(aes(x=order_dow)) + 
  geom_histogram(stat="count",fill="orange")
```

How long do they take to order again
```{r}
orders %>% 
  ggplot(aes(x=days_since_prior_order)) + 
  geom_histogram(stat="count",fill="yellow")

```

How many orders are previously placed?
```{r}
orders %>% filter(eval_set=="prior") %>% count(order_number) %>% ggplot(aes(order_number,n)) + geom_line(color="red", size=1)+geom_point(size=2, color="red")
```

Check purchase history of individual customer
All the products each user bought and the total number of purchases per user:
```{r}
ordered_items_per_user <- rbind(order_products_prior, order_products) %>% 
  inner_join(orders, by="order_id") %>% 
  group_by(user_id) %>%
  summarise(ordered_items = as.vector(list(product_id)), 
            n_orders = length(unique(order_id)))
```

Orders per user
```{r}
hist(ordered_items_per_user$n_orders, breaks = 0:105, ylim = c(0, 25000), ylab="Number of users", xlab="Number of orders", main="Orders per user")
mtext(paste("Total:", sum(ordered_items_per_user$n_orders), "orders,",  nrow(ordered_items_per_user), "users"), padj = 0.6)
```


```{r cars, eval=FALSE, include=FALSE}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, eval=FALSE, include=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
